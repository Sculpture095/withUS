<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Bootstrap icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,300;0,500;0,600;0,700;1,300;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,400;1,400&display=swap" rel="stylesheet">

    <!-- Core theme CSS -->
    <link rel="stylesheet" th:href="@{/css/header_footer.css}">
    <script th:src="@{/js/header_footer.js}"></script>
</head>
<body>
<!-- Thymeleaf fragment for header -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top shadow-sm" id="mainNav" th:fragment="header">
    <div class="container px-5">
        <a class="navbar-brand fw-bold" th:href="@{/}">
            <img th:src="@{/img/withUS.png}" alt="WithUs Logo">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            Menu <i class="bi-list"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto me-4 my-3 my-lg-0">
                <li class="nav-item"><a class="nav-link me-lg-3" th:href="@{/registerProject}">프로젝트 등록</a></li>
                <li class="nav-item"><a class="nav-link me-lg-3" th:href="@{/findProject}">프로젝트 찾기</a></li>
                <li class="nav-item"><a class="nav-link me-lg-3" th:href="@{/findPartner}">파트너스 찾기</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link me-lg-3 dropdown-toggle" href="#" id="navbarDropdown1" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        게시판
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown1">
                        <li><a class="dropdown-item" th:href="@{/board/it}">IT 게시판</a></li>
                        <li><a class="dropdown-item" th:href="@{/board/free}">자유 게시판</a></li>
                        <li><a class="dropdown-item" th:href="@{/board/notice}">공지 게시판</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link me-lg-3 dropdown-toggle" href="#" id="navbarDropdown2" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        이용방법
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown2">
                        <li><a class="dropdown-item" th:href="@{/guide/ask}">문의</a></li>
                        <li><a class="dropdown-item" th:href="@{/guide/case}">고객 사례</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link me-lg-3" href="#" onclick="redirectToMyPage()">마이페이지</a>
                </li>
            </ul>

            <!-- 로그인 버튼: 세션에 nickname이 없으면 표시 -->
            <button class="btn btn-primary rounded-pill px-3 mb-2 mb-lg-0 bg-gradient-primary-to-secondary"
                    th:if="${session.nickname == null}"
                    th:onclick="|location.href='@{/login}'|">
    <span class="d-flex align-items-center">
        <i class="bi-chat-text-fill me-2"></i>
        <span class="small">로그인</span>
    </span>
            </button>

            <!-- 로그인 후 환영 메시지와 로그아웃 버튼 -->
            <!--/*@thymesVar id="getAttribute" type=""*/-->
            <div th:if="${session.nickname != null}" style="display: flex; gap: 10px; align-items: center;">
    <span class="btn btn-primary rounded-pill px-3 mb-2 mb-lg-0">
        <span class="d-flex align-items-center">
            <i class="bi-person-fill me-2"></i>
            <span class="small" th:text="${session.nickname + '님 환영합니다'}"></span>
        </span>
    </span>
                <button class="btn btn-secondary rounded-pill px-3 mb-2 mb-lg-0" id="logoutBtn">
                    로그아웃
                </button>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const logoutButton = document.getElementById("logoutBtn");

                    if (logoutButton) {
                        logoutButton.addEventListener("click", function () {
                            // ✅ JSESSIONID 쿠키 삭제 (서버에서 처리되므로 불필요할 수도 있음)
                            document.cookie = "JSESSIONID=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT;";

                            // ✅ Spring Security 로그아웃 URL로 직접 이동
                            window.location.href = "/logout";
                        });
                    }
                });

                function redirectToMyPage() {
                    let isLoggedIn = [[${session != null and session.nickname != null}]];
                    if (!isLoggedIn) {
                        alert("로그인이 필요합니다.");
                        window.location.href = "/login";
                        return;
                    }

                    let userType = "[[${session.pcaType}]]"; // Thymeleaf에서 사용자 유형 가져오기
                    if (userType === "PARTNER") {
                        window.location.href = "/p_myPage";
                    } else if (userType === "CLIENT") {
                        window.location.href = "/c_myPage";
                    } else {
                        alert("잘못된 접근입니다.");
                    }
                }
            </script>


        </div>
    </div>
</nav>
</body>
</html>
