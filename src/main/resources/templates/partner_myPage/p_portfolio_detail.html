<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Google fonts-->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,600;1,600&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,300;0,500;0,600;0,700;1,300;1,500;1,600;1,700&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,400;1,400&amp;display=swap" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="/css/main.css" rel="stylesheet" />
    <link href="/css/p_myPage.css" rel="stylesheet" />
    <title>Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ</title>
</head>
<body>
<!-- Header -->
<div th:replace="~{header :: header}"></div>

    <div class="wrapper">
        <div class="mypage_container">
            <div class="sidebar_content">
                <div class="profile_box items-center">
                    <div class="user_img_box"><a href="img"></a></div>
                    <div class="user_text">
                        <h2>Ïú†Ï†ÄÏïÑÏù¥Îîî</h2>
                        <p th:text="${member.email}"></p>
                    </div>
                </div>
                <!-- Sidebar -->
                <div class="sidebar_menu">
                    <ul class="mt-8 space-y-4">
                        <li>
                            <a th:href="@{/p_myPage}" class="flex justify-between items-center textdeco">
                                <span>Í∞úÏù∏Ï†ïÎ≥¥ Í¥ÄÎ¶¨</span>
                                <span>&gt;</span>
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/findProject/partner/applied}" class="flex justify-between items-center textdeco">
                                <span>ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨</span>
                                <span>&gt;</span>
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/partner/skills}"  class="flex justify-between items-center textdeco">
                                <span>Î≥¥Ïú†Í∏∞Ïà† Í¥ÄÎ¶¨</span>
                                <span>&gt;</span>
                            </a>
                        </li>
                        <li class="current-page">
                            <a th:href="@{/partner/portfolio}"  class="flex justify-between items-center textdeco">
                                <span>Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Í¥ÄÎ¶¨</span>
                                <span>&gt;</span>
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/partner/history}" class="flex justify-between items-center textdeco">
                                <span>Í≤ΩÎ†• Í¥ÄÎ¶¨</span>
                                <span>&gt;</span>
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/partner/education}" class="flex justify-between items-center textdeco">
                                <span>ÌïôÎ†• Í¥ÄÎ¶¨</span>
                                <span>&gt;</span>
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/partner/certificate}" class="flex justify-between items-center textdeco">
                                <span>ÏûêÍ≤©Ï¶ù Í¥ÄÎ¶¨</span>
                                <span>&gt;</span>
                            </a>
                        </li>
                    </ul>
                </div>
          </div>

            <!-- Main Content -->
            <div class="content">
                <div class="section">
                  
                    <div class="portfolio_detail_grid">
                        <div class="portfolio_item">
                            <!-- Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ID Ï†ÄÏû• (Ïà®ÍπÄ Ï≤òÎ¶¨) -->
                            <input type="hidden" id="portfolioId" th:value="${portfolio.portfolioId}">
                            <!-- Ï†úÎ™© -->
                            <h2 id="portfolioTitleText" class="portfolio_title" th:text="${portfolio.portfolioTitle}">Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Ï†úÎ™©</h2>
                            <input type="text" id="portfolioTitleInput" class="portfolio_title input_field" style="display: none;">
                    
                            <!-- ÎÇ¥Ïö© -->
                            <p id="portfolioDescriptionText" class="portfolio_description" th:text="${portfolio.portfolioContext}">Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÎÇ¥Ïö©</p>
                            <textarea id="portfolioDescriptionInput" class="portfolio_description input_field" style="display: none;"></textarea>
                    
                            <!-- ÌååÏùºÏÑ†ÌÉù(Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Ïà®ÍπÄ) -->
                            <div class="image_upload_container file-input-container" style="display: none;">
                                <input type="file" id="imageUpload" class="image_upload" accept="image/*" multiple>
                            </div>

                            <!-- Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ ÏòÅÏó≠ -->
                        <div class="portfolio_image" id="portfolioImageContainer">
                            <!-- Í∏∞Ï°¥ Ïù¥ÎØ∏ÏßÄ Ïú†ÏßÄ -->
                            <div class="image_item">
                                <div class="portfolio-image-container">
                                    <img th:src="${portfolio.portfolioImg}" />

                                </div>
                            </div>
                        </div>

                            <div class="portfolio_buttons">
                                <button class="btn edit_btn" onclick="enableEditing()">ÏàòÏ†ï</button>
                                <button class="btn delete_btn" id="deleteButton" onclick="deletePortfolio()">ÏÇ≠Ï†ú</button>
                                <button class="btn save_btn" onclick="saveChanges()" style="display: none;">Ï†ÄÏû•</button>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- wrapper -->


<!-- Footer -->
<div  th:replace="~{footer :: footer}"></div>

  <script>
    function enableEditing() {
        // Ï†úÎ™© Î∞è ÎÇ¥Ïö© Ïà®Í∏∞Í∏∞ & ÏûÖÎ†• ÌïÑÎìú Î≥¥Ïù¥Í∏∞
        document.getElementById("portfolioTitleText").style.display = "none";
        document.getElementById("portfolioDescriptionText").style.display = "none";
    
        document.getElementById("portfolioTitleInput").style.display = "block";
        document.getElementById("portfolioDescriptionInput").style.display = "block";
    
        // Í∏∞Ï°¥ Ï†úÎ™©/ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†• ÌïÑÎìúÏóê ÎÑ£Í∏∞
        document.getElementById("portfolioTitleInput").value = document.getElementById("portfolioTitleText").innerText;
        document.getElementById("portfolioDescriptionInput").value = document.getElementById("portfolioDescriptionText").innerText;
    
        // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÌïÑÎìú Î≥¥Ïù¥Í∏∞
        document.querySelector(".image_upload_container").style.display = "block";
    
        // X Î≤ÑÌäº Î≥¥Ïù¥Í∏∞
        document.querySelectorAll(".delete_img_btn").forEach(button => {
            button.style.display = "flex";
        });
    
        // Ïù¥ÎØ∏ÏßÄ Ïª®ÌÖåÏù¥ÎÑàÎ•º ÏàòÏ†ï Î™®ÎìúÎ°ú Î≥ÄÍ≤Ω (ÏûëÏùÄ Ïù¥ÎØ∏ÏßÄ Ïó¨Îü¨ Ïû• Î∞∞Ïπò)
        document.getElementById("portfolioImageContainer").classList.add("editing");
    
        // ÏÇ≠Ï†ú Î≤ÑÌäº Ïà®Í∏∞Í∏∞
        document.getElementById("deleteButton").style.display = "none";
    
        // Î≤ÑÌäº Î≥ÄÍ≤Ω (ÏàòÏ†ï ‚Üí Ï†ÄÏû•)
        document.querySelector(".edit_btn").style.display = "none";
        document.querySelector(".save_btn").style.display = "inline-block";
    }

    function saveChanges() {
        let portfolioInput = document.getElementById("portfolioId");
        if (!portfolioInput || !portfolioInput.value) {
            console.error("‚ùå portfolioId ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
            alert("Ïò§Î•ò Î∞úÏÉù: Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ IDÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
            return;
        }
        let portfolioId = portfolioInput.value.trim(); // üîπ UUID Í≥µÎ∞± Ï†úÍ±∞

        let newTitle = document.getElementById("portfolioTitleInput").value.trim();
        let newDescription = document.getElementById("portfolioDescriptionInput").value.trim();

        let requestData = {
            portfolioId: portfolioId, // üîπ UUIDÍ∞Ä Î¨∏ÏûêÏó¥Î°ú Ï†ÑÎã¨ÎêòÎèÑÎ°ù ÌôïÏù∏
            portfolioTitle: newTitle,
            portfolioContext: newDescription
        };

        console.log("üì§ Ï†ÑÏÜ° Îç∞Ïù¥ÌÑ∞:", requestData); // ‚úÖ ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏

        fetch("/partner/portfolio/update", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestData)
        })
            .then(response => {
                console.log("üõ† ÏùëÎãµ ÏÉÅÌÉú:", response.status); // ‚úÖ ÏùëÎãµ ÏÉÅÌÉú ÌôïÏù∏
                return response.text();
            })
            .then(data => {
                console.log("üì• ÏùëÎãµ Îç∞Ïù¥ÌÑ∞:", data); // ‚úÖ ÏùëÎãµ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                alert(data);
                if (response.status === 200) location.reload();
            })
            .catch(error => console.error("‚ùå ÏöîÏ≤≠ Ïò§Î•ò:", error));
    }

    function deletePortfolio() {
        let portfolioId = document.getElementById("portfolioId").value;

        if (!confirm("Ìè¨Ìä∏Ìè¥Î¶¨Ïò§Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

        console.log("üóë ÏÇ≠Ï†ú ÏöîÏ≤≠ - Portfolio ID:", portfolioId);

        fetch(`/partner/portfolio/delete/${portfolioId}`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" }
        })
            .then(response => {
                console.log("üõ† ÏùëÎãµ ÏÉÅÌÉú:", response.status);
                let status = response.status; // ‚úÖ response.statusÎ•º Î≥ÄÏàòÏóê Ï†ÄÏû•
                return response.text().then(data => ({ status, data })); // ‚úÖ responseÏôÄ dataÎ•º Ìï®Íªò Ï†ÑÎã¨
            })
            .then(({ status, data }) => { // ‚úÖ response.status ÎåÄÏã† status ÏÇ¨Ïö©
                console.log("üì• ÏùëÎãµ Îç∞Ïù¥ÌÑ∞:", data);
                alert(data);
                if (status === 200) window.location.href = "/partner/portfolio"; // ‚úÖ Ï†ïÏÉÅ ÏûëÎèô
            })
            .catch(error => console.error("‚ùå ÏöîÏ≤≠ Ïò§Î•ò:", error));
    }






    // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Í∏∞Îä• (Ïó¨Îü¨ Ïû• Í∞ÄÎä• & Í∏∞Ï°¥ Ïù¥ÎØ∏ÏßÄ Ïú†ÏßÄ)
    document.getElementById("imageUpload").addEventListener("change", function(event) {
        let files = event.target.files;
        let imageContainer = document.getElementById("portfolioImageContainer");
    
        for (let i = 0; i < files.length; i++) {
            let file = files[i];
            let reader = new FileReader();
    
            reader.onload = function(e) {
                // ÏÉàÎ°úÏö¥ Ïù¥ÎØ∏ÏßÄ ÏöîÏÜå ÏÉùÏÑ±
                let newImage = document.createElement("div");
                newImage.classList.add("image_item");
                newImage.innerHTML = `
                    <img src="${e.target.result}" alt="Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Ïù¥ÎØ∏ÏßÄ">
                    <button class="delete_img_btn" onclick="deleteImage(this)">X</button>
                `;
                imageContainer.appendChild(newImage);
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Í∞úÎ≥Ñ Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú Í∏∞Îä•
    function deleteImage(button) {
        button.parentElement.remove();
    }
    
    
  </script>
</body>
</html>